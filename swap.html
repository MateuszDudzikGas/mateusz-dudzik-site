<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Combi â†’ Combi Boiler Swap | Fixed Prices & Warranties</title>
  <link rel="icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#202224; --bg2:#2b2d30;
      --card:#1e1f21; --card2:#2a2b2d;
      --accent:#00d084; --accent2:#00ffcc;
      --text:#f1f1f1; --muted:#ccffee; --muted2:#bde;
      --shadow:0 0 15px rgba(0,255,170,0.12);
      --radius:18px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Outfit,sans-serif;background:linear-gradient(to right,var(--bg1),var(--bg2));color:var(--text)}
    a{text-decoration:none}

    .nav{
      position:sticky;top:0;z-index:50;
      background:rgba(20,21,23,.82);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .nav-inner{
      max-width:1100px;margin:0 auto;
      padding:.65rem 1rem;
      display:flex;justify-content:center;gap:.6rem;flex-wrap:wrap
    }
    .nav a{
      padding:.55rem .9rem;border-radius:999px;
      color:var(--text);font-weight:800;
      border:1px solid rgba(255,255,255,.1);
      background:rgba(255,255,255,.03);
    }
    .nav a.primary{background:var(--accent);color:#000;border:none}

    .wrap{max-width:1100px;margin:0 auto;padding:2rem 1rem 3rem}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:1.5rem;
      border:1px solid rgba(255,255,255,.08);
    }
    .h1{
      font-size:2.2rem;margin-bottom:.4rem;
      background:linear-gradient(145deg,var(--accent2),#00b894);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .lead{color:var(--muted);line-height:1.7}
    .banner{
      background:var(--accent);color:#000;text-align:center;
      padding:10px 12px;font-weight:900;
      border-radius:14px;margin-top:1rem;
    }

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:.9rem;margin-top:1rem}
    @media (max-width:820px){.grid{grid-template-columns:1fr}}
    .boiler{
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.09);
      border-radius:16px;
      padding:1rem;
    }
    .boiler .brand{font-weight:900;color:var(--accent2);margin-bottom:.2rem}
    .boiler .meta{color:var(--muted2);line-height:1.5}
    .boiler ul{margin:.55rem 0 0 1.1rem}
    .boiler li{margin:.25rem 0;line-height:1.4}
    .badge{
      display:inline-block;margin-top:.55rem;
      padding:.25rem .6rem;border-radius:999px;
      font-weight:900;font-size:.92rem;
      background:rgba(0,208,132,.16);
      border:1px solid rgba(0,208,132,.28);
      color:var(--muted);
    }

    form{margin-top:1rem}
    label{display:block;margin-top:.9rem;font-weight:800}
    input,select,textarea{
      width:100%;margin-top:.35rem;padding:.9rem;
      border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:var(--card2);color:#fff;outline:none;
    }
    textarea{min-height:130px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    @media (max-width:820px){.row{grid-template-columns:1fr}}
    .btn{
      display:inline-block;margin-top:1rem;
      padding:.95rem 1.2rem;border-radius:12px;
      font-weight:900;border:1px solid rgba(255,255,255,.12);
      cursor:pointer;
    }
    .btn-primary{background:var(--accent);color:#000;border:none}
    .btn[disabled]{opacity:.65;cursor:not-allowed}

    .result{margin-top:1rem;padding:1rem;border-radius:14px;display:none}
    .ok{background:rgba(0,208,132,.16);border:1px solid rgba(0,208,132,.28)}
    .err{background:rgba(255,0,80,.12);border:1px solid rgba(255,0,80,.25)}

    .small{font-size:.95rem;color:var(--muted2);line-height:1.5;margin-top:.6rem}

    .uploadBox{
      margin-top:.5rem;
      padding:.9rem;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.18);
      background:rgba(255,255,255,.03);
    }
    .uploadTop{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .uploadHint{color:var(--muted2);font-size:.95rem;line-height:1.4}
    .preview{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .thumb{
      width:110px;height:110px;object-fit:cover;
      border-radius:14px;border:1px solid rgba(255,255,255,.14);
      box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
    }
    .fileBadge{
      display:inline-block;
      padding:.25rem .6rem;border-radius:999px;
      font-weight:900;font-size:.9rem;
      background:rgba(0,208,132,.14);
      border:1px solid rgba(0,208,132,.25);
      color:var(--muted);
    }
  </style>
</head>

<body>
  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html">Home</a>
      <a href="swap.html">Combi Swap</a>
      <a href="quote.html">Services & Quote</a>
      <a href="about.html">About</a>
      <a href="#request" class="primary">Request Swap</a>
    </div>
  </nav>

  <main class="wrap">
    <section class="card">
      <div class="h1">Combi â†’ Combi Boiler Swap</div>
      <p class="lead">
        <strong>Fixed prices â€” boiler supplied & installed.</strong><br>
        You choose the boiler option below, then send your details and I confirm a date (from 1 March).
      </p>

      <div class="banner">ðŸ“… Bookings available from <strong>1 March</strong></div>

      <p class="small">
        <strong>Warranty note:</strong> Warranty length applies when the boiler is registered after installation and serviced annually in line with manufacturer requirements.
      </p>

      <div class="grid">
        <div class="boiler">
          <div class="brand">Ideal InstinctÂ² Combi â€” 5-year warranty</div>
          <div class="meta">Accredited: Ideal â€¢ Reliable budget option</div>
          <div class="small">Good choice for smaller homes and straightforward swaps.</div>
          <ul>
            <li>24 kW â€” <strong>Â£1,600 installed</strong></li>
            <li>30 kW â€” <strong>Â£1,800 installed</strong></li>
            <li>35 kW â€” <strong>Â£2,000 installed</strong></li>
          </ul>
          <span class="badge">Budget & solid</span>
        </div>

        <div class="boiler">
          <div class="brand">Ideal Logic+ Combi â€” 7-year warranty</div>
          <div class="meta">Accredited: Ideal â€¢ Mid-range option</div>
          <div class="small">Balanced performance and warranty â€” a safe all-rounder.</div>
          <ul>
            <li>24 kW â€” <strong>Â£2,000 installed</strong></li>
            <li>30 kW â€” <strong>Â£2,200 installed</strong></li>
          </ul>
        </div>

        <div class="boiler">
          <div class="brand">Ideal Logic Max Combi â€” 12-year warranty</div>
          <div class="meta">Accredited: Ideal â€¢ Long warranty, premium Logic</div>
          <div class="small">Best value for long peace of mind (12-year warranty).</div>
          <ul>
            <li>24 kW â€” <strong>Â£2,250 installed</strong></li>
            <li>30 kW â€” <strong>Â£2,450 installed</strong></li>
            <li>35 kW â€” <strong>Â£2,650 installed</strong></li>
          </ul>
          <span class="badge">Best value warranty</span>
        </div>

        <div class="boiler">
          <div class="brand">Ideal Vogue Max Combi â€” 12-year warranty</div>
          <div class="meta">Accredited: Ideal â€¢ Premium Ideal range</div>
          <div class="small">Top Ideal option for customers wanting premium feel.</div>
          <ul>
            <li>26 kW â€” <strong>Â£2,600 installed</strong></li>
            <li>32 kW â€” <strong>Â£2,800 installed</strong></li>
          </ul>
          <span class="badge">Premium Ideal</span>
        </div>

        <div class="boiler">
          <div class="brand">Vaillant ecoTEC plus â€” 10-year warranty</div>
          <div class="meta">Accredited: Vaillant â€¢ Premium brand</div>
          <div class="small">Quiet operation, strong support and premium build.</div>
          <ul>
            <li>ecoTEC plus 832 â€” <strong>Â£2,600 installed</strong></li>
            <li>ecoTEC plus 835 â€” <strong>Â£2,800 installed</strong></li>
          </ul>
          <span class="badge">Premium</span>
        </div>

        <div class="boiler">
          <div class="brand">Viessmann Vitodens 100-W â€” 7-year warranty</div>
          <div class="meta">Accredited: Viessmann â€¢ Efficient and robust</div>
          <div class="small">Great efficiency and build quality â€” strong mid-premium option.</div>
          <ul>
            <li>26 kW â€” <strong>Â£2,400 installed</strong></li>
            <li>30 kW â€” <strong>Â£2,600 installed</strong></li>
            <li>35 kW â€” <strong>Â£2,800 installed</strong></li>
          </ul>
        </div>
      </div>

      <p class="small" style="margin-top:1rem;">
        <strong>Standard installation</strong> assumes a like-for-like combi swap.
        If pipework/flue/condensate changes are required, final price will be confirmed after survey/photos.
      </p>
    </section>

    <section class="card" id="request" style="margin-top:1rem;">
      <div class="h1">Request your Combi Swap</div>
      <p class="lead">
        Choose your boiler option, add your details, and describe your current setup.
        Upload up to <strong>4 photos</strong> (boiler, flue, meter, location) to confirm scope fast.
      </p>

      <form id="swapForm" enctype="multipart/form-data" novalidate>
        <div class="row">
          <div>
            <label>Full name</label>
            <input name="name" required placeholder="John Smith">
          </div>
          <div>
            <label>Phone</label>
            <input name="phone" required placeholder="07...">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Email</label>
            <input type="email" name="email" required placeholder="name@email.com">
          </div>
          <div>
            <label>Postcode</label>
            <input name="postcode" required placeholder="DN4...">
          </div>
        </div>

        <label>Select boiler option (fixed price)</label>
        <select name="service" required>
          <option value="">Selectâ€¦</option>
          <option>Combiâ†’Combi Swap â€” Ideal InstinctÂ² 24kW â€” Â£1,600 (5y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal InstinctÂ² 30kW â€” Â£1,800 (5y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal InstinctÂ² 35kW â€” Â£2,000 (5y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal Logic+ 24kW â€” Â£2,000 (7y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal Logic+ 30kW â€” Â£2,200 (7y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal Logic Max 24kW â€” Â£2,250 (12y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal Logic Max 30kW â€” Â£2,450 (12y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal Logic Max 35kW â€” Â£2,650 (12y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal Vogue Max 26kW â€” Â£2,600 (12y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Ideal Vogue Max 32kW â€” Â£2,800 (12y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Vaillant ecoTEC plus 832 â€” Â£2,600 (10y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Vaillant ecoTEC plus 835 â€” Â£2,800 (10y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Viessmann Vitodens 100-W 26kW â€” Â£2,400 (7y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Viessmann Vitodens 100-W 30kW â€” Â£2,600 (7y warranty)</option>
          <option>Combiâ†’Combi Swap â€” Viessmann Vitodens 100-W 35kW â€” Â£2,800 (7y warranty)</option>
        </select>

        <label>Details (current boiler, flue position, property type, any issues)</label>
        <textarea name="message" required placeholder="Example: Current boiler model, flue location, number of bathrooms, any low pressure/dirty system, etc."></textarea>

        <label>Upload up to 4 photos</label>
        <div class="uploadBox">
          <div class="uploadTop">
            <div class="uploadHint">
              Recommended: boiler front, inside (if safe), flue outside, gas meter / cupboard wide shot.
              <div style="margin-top:.4rem;">
                <span class="fileBadge" id="fileCount">0 / 4 selected</span>
                <span class="fileBadge" id="fileRule" style="margin-left:.4rem;">High quality (auto optimised)</span>
              </div>
            </div>
          </div>

          <input id="photos" name="photos" type="file" accept="image/*" multiple />
          <div class="preview" id="photoPreview"></div>
        </div>

        <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">

        <button id="submitBtn" class="btn btn-primary" type="submit">Send swap request</button>

        <div id="resultOk" class="result ok"><strong>Sent!</strong> Thanks â€” Iâ€™ll contact you shortly.</div>
        <div id="resultErr" class="result err"><strong>Oops.</strong> <span id="errText">Something went wrong. Please try again.</span></div>

        <p class="small">
          <strong>Warranty:</strong> warranty length applies when registered after installation and serviced annually in line with manufacturer requirements.
        </p>
      </form>
    </section>
  </main>

  <script>
    const form = document.getElementById('swapForm');
    const ok = document.getElementById('resultOk');
    const err = document.getElementById('resultErr');
    const errText = document.getElementById('errText');
    const btn = document.getElementById('submitBtn');

    const photoInput = document.getElementById('photos');
    const preview = document.getElementById('photoPreview');
    const fileCount = document.getElementById('fileCount');

    const MAX_FILES = 4;

    // HIGH QUALITY SETTINGS (as requested)
    const MAX_UPLOAD_MB_TOTAL = 18; // after compression
    const MAX_DIM = 2400;           // max long edge
    const JPEG_QUALITY = 0.88;      // jpeg quality

    function setError(message){
      errText.textContent = message;
      err.style.display = "block";
    }

    async function compressImage(file, maxSize = MAX_DIM, quality = JPEG_QUALITY) {
      const bitmap = await createImageBitmap(file);
      const ratio = Math.min(1, maxSize / Math.max(bitmap.width, bitmap.height));
      const w = Math.round(bitmap.width * ratio);
      const h = Math.round(bitmap.height * ratio);

      const canvas = document.createElement("canvas");
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(bitmap, 0, 0, w, h);

      const blob = await new Promise((resolve) =>
        canvas.toBlob(resolve, "image/jpeg", quality)
      );

      if (!blob) throw new Error("Could not process image. Please try a different photo.");

      const newName = (file.name || "photo").replace(/\.(png|jpg|jpeg|webp)$/i, "") + ".jpg";
      return new File([blob], newName, { type: "image/jpeg" });
    }

    photoInput.addEventListener('change', () => {
      preview.innerHTML = "";
      err.style.display = "none";
      ok.style.display = "none";

      const files = Array.from(photoInput.files || []);
      fileCount.textContent = `${files.length} / ${MAX_FILES} selected`;

      if (files.length > MAX_FILES) {
        photoInput.value = "";
        fileCount.textContent = `0 / ${MAX_FILES} selected`;
        setError(`Please select up to ${MAX_FILES} photos.`);
        return;
      }

      files.forEach((file) => {
        const url = URL.createObjectURL(file);
        const img = document.createElement("img");
        img.src = url;
        img.alt = file.name;
        img.className = "thumb";
        preview.appendChild(img);
      });
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      ok.style.display = "none";
      err.style.display = "none";

      if (form.website.value.trim() !== "") return;

      if (!form.checkValidity()) {
        setError("Please fill in all required fields.");
        return;
      }

      const files = Array.from(photoInput.files || []);
      if (files.length > MAX_FILES) {
        setError(`Please select up to ${MAX_FILES} photos.`);
        return;
      }

      btn.disabled = true;
      const oldBtnText = btn.textContent;
      btn.textContent = "Optimising photos...";

      try {
        const compressed = [];
        for (const f of files) {
          const cf = await compressImage(f);
          compressed.push(cf);
        }

        const totalBytes = compressed.reduce((a, f) => a + f.size, 0);
        const totalMB = totalBytes / (1024*1024);

        if (totalMB > MAX_UPLOAD_MB_TOTAL) {
          throw new Error(`Photos still too large (${totalMB.toFixed(1)}MB). Please send fewer photos or take lower-resolution photos.`);
        }

        const fd = new FormData(form);
        fd.delete("photos");
        compressed.forEach((f) => fd.append("photos", f, f.name));

        btn.textContent = "Sending...";

        const res = await fetch("/api/quote", { method: "POST", body: fd });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data?.error || "Upload failed");

        ok.style.display = "block";
        form.reset();
        preview.innerHTML = "";
        fileCount.textContent = `0 / ${MAX_FILES} selected`;
      } catch (e2) {
        setError(e2?.message || "Something went wrong. Please try again.");
      } finally {
        btn.disabled = false;
        btn.textContent = oldBtnText;
      }
    });
  </script>
</body>
</html>
